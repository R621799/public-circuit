<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Shoe Generator - Kinetic Energy Simulation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a2e; overflow: hidden; }
        #canvas-container { width: 100vw; height: 100vh; display: block; }
        #controls {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255, 255, 255, 0.95); padding: 20px;
            border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            min-width: 300px; z-index: 100;
        }
        h1 { font-size: 18px; margin-bottom: 10px; color: #1e3c72; border-bottom: 2px solid #2a5298; }
        .control-group { margin-bottom: 12px; }
        label { display: block; font-size: 12px; font-weight: 600; color: #333; }
        button {
            width: 100%; padding: 10px; margin: 5px 0; border: none;
            border-radius: 6px; cursor: pointer; font-weight: bold;
            transition: 0.3s; text-transform: uppercase;
        }
        #press-pedal { background: #764ba2; color: white; }
        #reset { background: #f39c12; color: white; }
        input[type="range"] { width: 100%; }
        .info-display { background: #ecf0f1; padding: 10px; border-radius: 6px; font-size: 12px; }
        .info-item { display: flex; justify-content: space-between; margin: 3px 0; }
        #instruction-overlay {
            position: absolute; bottom: 20px; right: 20px; color: white;
            background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="controls">
        <h1>‚ö° Pro Shoe Generator</h1>
        <div class="control-group">
            <label>Sensitivity (Mouse Drag):</label>
            <input type="range" id="sensitivity" min="0.1" max="2" value="1" step="0.1">
        </div>
        <div class="control-group">
            <button id="press-pedal">Press Pedal (Space)</button>
            <button id="reset">Reset System</button>
        </div>
        <div class="info-display">
            <div class="info-item"><span>Motor RPM:</span><span id="motor-rpm">0</span></div>
            <div class="info-item"><span>Output:</span><span id="current">0 mA</span></div>
            <div class="info-item"><span>Zoom:</span><span id="zoom-val">100%</span></div>
        </div>
    </div>

    <div id="instruction-overlay">
        üñ±Ô∏è Scroll to Zoom | üëÜ Drag vertically to move Rack
    </div>

    <div id="canvas-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0f172a);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(8, 6, 8);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // --- LIGHTING ---
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(5, 10, 7.5);
        scene.add(sun, new THREE.AmbientLight(0xffffff, 0.4));

        // --- MATERIALS ---
        const matSteel = new THREE.MeshStandardMaterial({ color: 0x718096, metalness: 0.8, roughness: 0.2 });
        const matGear = new THREE.MeshStandardMaterial({ color: 0xe53e3e, metalness: 0.6 });
        const matMotor = new THREE.MeshStandardMaterial({ color: 0x2d3748, metalness: 0.9 });

        // --- COMPONENTS ---
        // 1. Rack (Vertical)
        const rackGroup = new THREE.Group();
        const rackBody = new THREE.Mesh(new THREE.BoxGeometry(0.4, 4, 0.8), matSteel);
        rackGroup.add(rackBody);
        for(let i=0; i<15; i++) {
            const tooth = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.1, 0.8), matSteel);
            tooth.position.set(0.3, -1.8 + (i * 0.25), 0);
            rackGroup.add(tooth);
        }
        rackGroup.position.set(-2, 1, 0);
        scene.add(rackGroup);

        // 2. Pinion (Vertical rotation, parallel to rack)
        const pinionGroup = new THREE.Group();
        pinionGroup.add(new THREE.Mesh(new THREE.CylinderGeometry(0.8, 0.8, 0.4, 32), matGear));
        pinionGroup.rotation.z = Math.PI / 2; // Alignment
        pinionGroup.position.set(-0.9, 1, 0);
        scene.add(pinionGroup);

        // 3. Reversing Gear (Inverts and transfers motion)
        const reverseGear = new THREE.Group();
        reverseGear.add(new THREE.Mesh(new THREE.CylinderGeometry(0.6, 0.6, 0.3, 32), matSteel));
        reverseGear.rotation.z = Math.PI / 2;
        reverseGear.position.set(0.3, 1, 0);
        scene.add(reverseGear);

        // 4. Motor
        const motor = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 1.2, 32), matMotor);
        motor.rotation.z = Math.PI / 2;
        motor.position.set(1.8, 1, 0);
        scene.add(motor);

        // --- INTERACTION STATE ---
        const state = {
            rackY: 1,
            targetRackY: 1,
            isDragging: false,
            sensitivity: 1,
            zoom: 10,
            targetZoom: 10,
            rotation: 0
        };

        // --- EVENT LISTENERS ---
        // Mouse Move Interaction
        window.addEventListener('pointerdown', () => state.isDragging = true);
        window.addEventListener('pointerup', () => state.isDragging = false);
        window.addEventListener('pointermove', (e) => {
            if (state.isDragging) {
                // Drag vertically to push the rack
                const delta = e.movementY * 0.01 * state.sensitivity;
                state.targetRackY = Math.max(-1, Math.min(3, state.targetRackY - delta));
            }
        });

        // Zoom functionality
        window.addEventListener('wheel', (e) => {
            state.targetZoom = Math.max(4, Math.min(20, state.targetZoom + e.deltaY * 0.01));
            document.getElementById('zoom-val').textContent = Math.round(1000/state.targetZoom) + "%";
        });

        document.getElementById('sensitivity').oninput = (e) => state.sensitivity = e.target.value;
        document.getElementById('reset').onclick = () => state.targetRackY = 1;

        // --- ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);

            // Smooth Movement (Lerp)
            state.rackY += (state.targetRackY - state.rackY) * 0.1;
            rackGroup.position.y = state.rackY;

            // Kinematics: Calculate rotation based on Rack displacement
            // Distance = Initial(1) - Current
            const displacement = 1 - state.rackY;
            const radius = 0.8;
            state.rotation = displacement / radius;

            // Apply rotations
            pinionGroup.rotation.x = state.rotation;         // Pinion
            reverseGear.rotation.x = -state.rotation * 1.3;  // Reversing direction + gear ratio
            motor.rotation.x = state.rotation * 5;           // High speed motor rotation

            // Zoom Update
            state.zoom += (state.targetZoom - state.zoom) * 0.1;
            camera.position.setLength(state.zoom);

            // UI Updates
            const rpm = Math.abs(Math.round(state.rotation * 500));
            document.getElementById('motor-rpm').textContent = rpm;
            document.getElementById('current').textContent = (rpm * 0.15).toFixed(1) + " mA";

            renderer.render(scene, camera);
        }

        animate();

        // Handle Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>