<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shoe Generator - Real Physics Build</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a2e; overflow: hidden; }
        #canvas-container { width: 100vw; height: 100vh; display: block; }
        #controls { position: absolute; top: 20px; left: 20px; background: rgba(255, 255, 255, 0.95); padding: 20px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); min-width: 280px; z-index: 100; }
        h1 { font-size: 18px; margin-bottom: 15px; color: #1e3c72; border-bottom: 2px solid #2a5298; padding-bottom: 8px; }
        button { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; }
        #press-pedal { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        #reset { background: #f39c12; color: white; }
        input[type="range"] { width: 100%; margin: 8px 0; }
        .info-display { background: #ecf0f1; padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 12px; }
        .info-item { display: flex; justify-content: space-between; margin: 5px 0; }
        .info-value { color: #2a5298; font-weight: 700; }
        #info { position: absolute; bottom: 20px; left: 20px; background: rgba(255, 255, 255, 0.95); padding: 15px; border-radius: 12px; font-size: 12px; max-width: 280px; z-index: 100; }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    <div id="controls">
        <h1>âš¡ Shoe Generator Control</h1>
        <div class="control-group">
            <button id="press-pedal">Press Foot Pedal</button>
            <button id="reset">Reset Simulation</button>
        </div>
        <div class="control-group">
            <label>Compression Speed: <span id="speed-value">5</span></label>
            <input type="range" id="speed" min="1" max="10" value="5">
        </div>
        <div class="info-display">
            <div class="info-item"><span>Electrons:</span> <span class="info-value" id="electron-count">0</span></div>
            <div class="info-item"><span>Motor RPM:</span> <span class="info-value" id="motor-rpm">0</span></div>
            <div class="info-item"><span>Current:</span> <span class="info-value" id="current">0 mA</span></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a1a);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(5, 4, 6);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // Lighting
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(10, 10, 5);
        scene.add(dirLight);

        // --- MATERIALS ---
        const matSteel = new THREE.MeshStandardMaterial({ color: 0x7f8c8d, metalness: 0.8, roughness: 0.2 });
        const matGear = new THREE.MeshStandardMaterial({ color: 0xe74c3c, metalness: 0.5 });
        const matMotor = new THREE.MeshStandardMaterial({ color: 0x2c3e50, metalness: 0.9 });

        // --- MECHANICAL COMPONENTS ---

        // 1. TOOTHED RACK
        const rackGroup = new THREE.Group();
        const rackBody = new THREE.Mesh(new THREE.BoxGeometry(0.4, 4, 0.4), matSteel);
        rackGroup.add(rackBar = rackBody);
        
        // Add Real Teeth to Rack (Oriented towards Gear)
        for(let i=0; i<16; i++) {
            const tooth = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.08, 0.3), matSteel);
            tooth.position.set(0.25, -1.8 + (i * 0.25), 0);
            rackGroup.add(tooth);
        }
        rackGroup.position.set(-1.2, 2, 0);
        scene.add(rackGroup);

        // 2. PINION & MOTOR ASSEMBLY (Horizontal Axis Rotation)
        const transmission = new THREE.Group();

        // Pinion Gear (Vertical Orientation)
        const pinionGroup = new THREE.Group();
        const gearRadius = 0.75;
        pinionGroup.add(new THREE.Mesh(new THREE.CylinderGeometry(gearRadius, gearRadius, 0.3, 32), matGear));
        
        // Pinion Teeth
        for(let i=0; i<12; i++) {
            const angle = (i/12) * Math.PI * 2;
            const tooth = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.3, 0.1), matGear);
            tooth.position.set(Math.cos(angle)*gearRadius, 0, Math.sin(angle)*gearRadius);
            tooth.rotation.y = angle;
            pinionGroup.add(tooth);
        }
        pinionGroup.rotation.z = Math.PI / 2; // Flip to vertical
        transmission.add(pinionGroup);

        // Motor (Horizontal orientation)
        const motor = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 1.5, 32), matMotor);
        motor.rotation.z = Math.PI / 2;
        motor.position.x = 1.2;
        transmission.add(motor);

        transmission.position.set(-0.3, 1, 0); // Meshed position
        scene.add(transmission);

        // --- LOGIC & ANIMATION ---
        const state = { pedalY: 2, targetY: 2, electrons: 0, speed: 5 };

        document.getElementById('press-pedal').onmousedown = () => state.targetY = 0.2;
        document.getElementById('press-pedal').onmouseup = () => state.targetY = 2;
        
        function animate() {
            requestAnimationFrame(animate);
            
            const lastY = state.pedalY;
            state.pedalY += (state.targetY - state.pedalY) * 0.1 * state.speed;
            
            // Move Rack
            rackGroup.position.y = state.pedalY - 1;
            
            // Physics: Rotation = Distance / Radius
            const deltaY = lastY - state.pedalY;
            const rotationDelta = deltaY / gearRadius;
            
            // Vertical Rack translates to X-axis rotation of transmission
            transmission.rotation.x += rotationDelta;

            // Stats Update
            const rpm = Math.abs(deltaY) * 6000;
            document.getElementById('motor-rpm').innerText = Math.round(rpm);
            document.getElementById('current').innerText = Math.round(rpm * 0.2) + " mA";

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>